[上一章(索引优化和查询优化)](./QUERY_OPTIMIZATION_INDEX_OPTIMIZATION.MD)
# 数据库的设计原则和规范

## 范式
在关系型数据库中，关于数据表设计的基本原则、规则就称为范式。可以理解为，一张数据表的设计结
构需要满足的某种设计标准的级别。要想设计一个结构合理的关系型数据库，必须满足一定的范式。

目前关系型数据库有六种常见范式，按照范式级别，从低到高分别是：第一范式（1NF）、第二范式
（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美
范式）。

### 键和相关属性的概念

*超键:在关系中能唯一标识元组的属性称为关系模式的超键
*候选键:不含多余属性超键称为候选键。也就是在候选键中，若再删除就不是键了。
*主键:用户选做元组标识的一个候选键程序主键
*外键:若时关系模式R中属性K是其他模式的主键，那么k在模式R中称为外键.

举例子:

| 学号 | 姓名 | 性别 | 年龄 | 系别 | 专业 |
| ---- | ---- | ---- | ---- | ---- | ---- |
|20020612 |李辉 |男 |20 |计算机 |软件开发 |
|20060613| 张明| 男 |18 |计算机 |软件开发 |
|20060614| 王小玉| 女 |19 |物理 |力学 |
|20060615| 李淑华| 女 |17 |生物 |动物学| 
|20060616| 赵静| 男 |21 |化学 |食品化学 |
|20060617| 赵静| 女 |20 |生物 |植物学总结|

1. 超键
在关系中能唯一标识元组的属性集称为关系模式的超键。
    因而咱们从例子中能够发现，学号是标识学生实体的唯一标识。
    除此以外咱们还能够把它跟其余属性组合起来:
    ('学号','性别'),('学号','年龄')。像这样也是超键
2.  候选键
不含有多余的属性的超键称为候选键
根据例子可知，学号是一个能够唯一标识元组的唯一标识，所以学号是一个候选键，实际上，候选键是超键的子集，好比(学号,年龄)是超键，可是它不是
候选键。由于它存在额外的属性。

3. 主键
用户选择的候选键作为该元组的唯一标识，那么它就为主键。
简单的说，例子中的元组的候选键为学号，可是咱们选定的它作为该元组的唯一标识，那么学号就为主键。


4. 外键
    外键是相对于主键的，好比在学生的记录里，主键为学号，在成绩单表中也有学号字段，所以学号为成绩单表的外键，为学生表的主键。




### 第一范式
数据库表的每一列都是不可分割的原子项
例子：
![第一范式拆分前](./files\数据库设计原则-1.png)
应该拆分为下图:
![第一范式拆分后](./files\数据库设计原则-2.png)

### 第二范式
每个表必须有且仅有一个数据元素为主键(Primary key),其他属性需完全依赖于主键
举例子:
比赛表 player_game ，里面包含球员编号、姓名、年龄、比赛编号、比赛时间和比赛场地等属性，这
里候选键和主键都为（球员编号，比赛编号），我们可以通过候选键（或主键）来决定如下的关系：
```text
(球员编号, 比赛编号) → (姓名, 年龄, 比赛时间, 比赛场地，得分)
```
但是这个数据表不满足第二范式，因为数据表中的字段之间还存在着如下的对应关系：  
```text
(球员编号) → (姓名，年龄)
(比赛编号) → (比赛时间, 比赛场地)
```
对于非主属性来说，并非完全依赖候选键。这样会产生怎样的问题呢？
```text
1. 数据冗余：如果一个球员可以参加 m 场比赛，那么球员的姓名和年龄就重复了 m-1 次。一个比赛
也可能会有 n 个球员参加，比赛的时间和地点就重复了 n-1 次。
2. 插入异常：如果我们想要添加一场新的比赛，但是这时还没有确定参加的球员都有谁，那么就没
法插入。
3. 删除异常：如果我要删除某个球员编号，如果没有单独保存比赛表的话，就会同时把比赛信息删
除掉。
4. 更新异常：如果我们调整了某个比赛的时间，那么数据表中所有这个比赛的时间都需要进行调
整，否则就会出现一场比赛时间不同的情况。
```
### 第三范式
数据表中的每一列都和主键直接相关，而不能间接相关联,不能有传递依赖的关系
举例子:
球员player表：球员编号、姓名、球队名称和球队主教练。现在，我们把属性之间的依赖关系画出
来，如下图所示： 
![第三范式](./files\数据库设计原则-3.png)
能看到球员编号决定了球队名称，同时球队名称决定了球队主教练，非主属性球队主教练就会传递依
赖于球员编号，因此不符合 3NF 的要求。
如果要达到 3NF 的要求，需要把数据表拆成下面这样：

|表名|属性(字段)|
| ---- | ---- |
|球员表|球员编号，姓名和球队名称|
|球队表|球队名称，球队主教练|


### 巴斯-科德BCNF




### 反范式化

```text
1. 为满足某种商业目标 , 数据库性能比规范化数据库更重要
2. 在数据规范化的同时 , 要综合考虑数据库的性能
3. 通过在给定的表中添加额外的字段，以大量减少需要从中搜索信息所需的时间
4. 通过在给定的表中插入计算列，以方便查询
```

* 反范式的新问题
    * 存储空间变大了
    * 一个表中字段做了修改，另一个表中冗余的字段也需要做同步修改，否则数据不一致
    * 若采用存储过程来支持数据的更新、删除等额外操作，如果更新频繁，会非常消耗系统资源
    * 在数据量小的情况下，反范式不能体现性能的优势，可能还会让数据库的设计更加复杂



