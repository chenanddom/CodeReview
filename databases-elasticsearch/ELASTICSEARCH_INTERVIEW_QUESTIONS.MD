# Elasticsearch面试题

## 为什么要使用 Elasticsearch？
```text
   系统中的数据，随着业务的发展，时间的退役，将会非常的多，而业务往往采用模糊查询进行数据的搜索，而模糊查询会导致查询引擎放弃索引， 
导致系统的查询都是进行全表扫描，在百万级别的数据库中，查询效率时非常低下的，而我们使用ES做一个全文索引，将经常查询的系统功能的某个
字段，比如说电商系统的商品表，描述，价格还有id这些字段我们都放入ES索引库中，可以提高查询到的速度。

```
## Elasticsearch 的 master 选举流程？
* Elasticsearch的选主时ZenDiscovery模块负责的，主要包含了Ping(节点之间通过这个RPC来发现彼此)和Unicast(淡泊模块包含，一个主机列表控
制哪些节点)这两个部分。
*　对所有可以称为master的节点(node.master: true)根据nodeId字典的排序，每次选举 每个节点都把自己所知道的节点排一次序，然后选出第一个
(第0位)节点，暂且认位它时master节点.
* 如果对某个节点的投票数达到一定的值(可以称为master节点数n/2+1)并且该节点自己也选举自己，那么这个节点就是master。否则重新选举一直到满足
上述的条件。
* master节点的职责主要负责集群、节点和索引的管理，不负责文档级别的管理，data节点可以关闭http功能.

## Elasticsearch集群脑裂的问题
* 造成脑裂的原因：
    *　1.网络问题：集群键的网络延迟导致一些系欸但访问不到master挂掉了从而选举出新的master，并且对master上的分片和副本标红，分配新的主分片
    * 2.节点负载:主节点的角色既位master又位data，访问量比较大时可能会导致ES停止响应造成大面积的延迟，此时其他节点得不到债转股节点的响应认位
        主节点挂掉了，会重新选取主节点。
    * 3.内存回收:data节点上的ES进程占用的内存比较大，引发的JVM的大规模内存回收，造成ES进程市区响应。

* 脑裂的问题解决方案：
    * 减少误判:discovery_zen_timeout节点状态的响应使劲按，默认位3秒，可以适当的调大，如果master在该响应时间范围内没有做出响应应答，
      判断该节点已经挂掉
    *  选举触发：discovery.zen.minimum._master_nodes:1,该参数主要用于控制选举行为发送的最小集群主节点数量。当备选节点的个数大于
        等于该参数的值，且备选主节点中有该参数个节点认位主节点挂了，进行选举。官方建议(n/2)+1,n为主节点个数(即有资格称为主节点的节点个数) 
    * 角色分离：即master节点与data节点分离，限制角色
        * 主节点配置为：node.master: true,node.data: false
        * 从节点配置: node.master: false,node.data:true    